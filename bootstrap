#!/usr/bin/env bash

BOOTSTRAP_DIR=$(dirname $BASH_SOURCE)
LIBRARY_DIR=$BOOTSTRAP_DIR/lib
MODULES_ACTIVE_DIR=$BOOTSTRAP_DIR/modules

function check_has_bash4
{
    ${BASH4:-bash} --version | grep -q "GNU bash.*version 4" || \
        { echo  "ERROR: Bash v4 or newer is required"; exit 1; }
}

function source_library()
{
    for file in $LIBRARY_DIR/*.sh
    do
        source $file EXPORT || { echo "Library error" && exit 1; }
    done
}

function main()
{
    check_has_bash4
	source_library
	for file in $MODULES_ACTIVE_DIR/*
	do
		[[ -x $file ]] && ( cd "$MODULES_ACTIVE_DIR" && ./$(basename $file) )
	done

}


main "$@"
